<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      internalLogFile="logs/internal-nlog.txt">

  <targets>
    <!-- Console target for real-time feedback -->
    <target xsi:type="ColoredConsole" 
            name="console"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message} ${exception:format=tostring}" />

    <!-- File target for all logs -->
    <target xsi:type="File" 
            name="allfile"
            fileName="logs/eventlogger-${shortdate}.log"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message} ${exception:format=tostring}"
            archiveFileName="logs/archives/eventlogger-{#}.log"
            archiveEvery="Day"
            archiveNumbering="Date"
            maxArchiveFiles="7" />

    <!-- File target for errors only -->
    <target xsi:type="File" 
            name="errorfile"
            fileName="logs/errors-${shortdate}.log"
            layout="${longdate}|${level:uppercase=true}|${logger}|${message}${newline}${exception:format=type,message,stacktrace:maxInnerExceptionLevel=5:innerFormat=shortType,message,method}"
            archiveFileName="logs/archives/errors-{#}.log"
            archiveEvery="Day"
            archiveNumbering="Date"
            maxArchiveFiles="30" />

    <!-- JSON structured logging -->
    <target xsi:type="File" 
            name="jsonfile"
            fileName="logs/eventlogger-${shortdate}.json"
            archiveFileName="logs/archives/eventlogger-{#}.json"
            archiveEvery="Day"
            archiveNumbering="Date"
            maxArchiveFiles="7">
      <layout xsi:type="JsonLayout" includeAllProperties="true">
        <attribute name="timestamp" layout="${longdate}" />
        <attribute name="level" layout="${level:uppercase=true}" />
        <attribute name="logger" layout="${logger}" />
        <attribute name="message" layout="${message}" />
        <attribute name="exception" layout="${exception:format=toString}" />
        <attribute name="processId" layout="${processid}" />
        <attribute name="threadId" layout="${threadid}" />
      </layout>
    </target>
  </targets>

  <rules>
    <!-- Log everything to console -->
    <logger name="*" minlevel="Info" writeTo="console" />
    
    <!-- Log everything to file -->
    <logger name="*" minlevel="Debug" writeTo="allfile" />
    
    <!-- Log errors to separate file -->
    <logger name="*" minlevel="Error" writeTo="errorfile" />
    
    <!-- Log everything as JSON -->
    <logger name="*" minlevel="Info" writeTo="jsonfile" />
  </rules>
</nlog>
